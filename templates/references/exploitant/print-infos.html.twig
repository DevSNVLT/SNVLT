<!doctype html>
<html lang="{{ app.user.locale }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{{ asset('assets/bootstrap-5.3.2/dist/css/bootstrap.min.css') }}">
    <title>Infos {% if (exploitant.sigle) %}{{ exploitant.sigle }} {% else %}{{ exploitant.raisonSocialeExploitant }} {% endif %}</title>

</head>
<body style="align-content: center;">
<section class="section justify-content-center">



    <style>
        @media print {
            @page {
                margin: 0;
            }
        }
    </style>

  <div class="" style="">

      <div class="alert-primary mt-4" style="height: 600px;">
            <center><h3><span  style="border: 1px solid; padding: 5px" class="p-1">Fiche Exploitant</span></h3></center>
            <center><h6><span   class="p-1 underline">Exercice {{ exercice }}</span></h6></center>
            <div class="card m-3 p-3"  style="border: 0px;font-size: 12px;">
                <h4>{{ exploitant.raisonSocialeExploitant }}</h4>
                <div class="d-inline-flex"><span style="font-weight: bold">code : </span><span style="margin-left: 10px;">{{ exploitant.numeroExploitant }}</span></div>
                <div class="d-inline-flex"><span style="font-weight: bold">marteau</span><span style="margin-left: 10px;">{{ exploitant.marteauExploitant }}</span></div>
                <div class="d-inline-flex"><span style="font-weight: bold">adresse</span><span style="margin-left: 10px;">{{ exploitant.situationGeographie }}</span></div>
                <div class="d-inline-flex"><span style="font-weight: bold">contact</span><span style="margin-left: 10px;">{{ exploitant.PersonneRessource }} | {{ exploitant.mobilePersonneRessource }}</span></div>
                <hr>
                <div class="card-body">
                    <div class="p-2 div_exploitation bg-white p-2" style="border: 1px solid lightgray;height: 500px;">
                        <span class="lbl_infos text-dark font-weight-bold alert-info p-2" style="font-size: large;width: 100%;"></span>
                        <div class="div_table">

                        </div>
                        <footer style="">
                            <hr>
                            <div class="d-sm-flex justify-content-center justify-content-sm-between">
                                <span class="text-dark d-block text-center text-sm-left d-sm-inline-block"><a class=" new-link" style="color: #58585b" href="https://www.eauxetforets.gouv.ci/" target="_blank">{% trans %}MINISTRY_NAME{% endtrans %}</a> </span>
                                <span class="text-dark d-block text-center text-sm-left d-sm-inline-block text_date"> </span>
                                <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">  <a href="https://www.system2is.gouv.ci/" style="color: #58585b" target="_blank">{% trans %}Copyright ©{% endtrans %} {% trans %}WEBSITE{% endtrans %} {% trans %}YEAR{% endtrans %}</a></span>
                            </div>
                        </footer>
                    </div>
                </div>
            </div>
      </div>
    </div>

</section>



<script src="{{ asset('assets/assets/js/jquery.min-3.5.1.js') }}"></script>
<script src="{{ asset('assets/webapp/assets/vendors/jquery/jquery.min.js') }}"></script>

<script>
    $(document).ready(function() {
        $('.text_date').text('imprimé le ' +  new Date().toLocaleDateString() + ' par {{ app.user }}' );
    })
    getExploitationInfos({{ exploitant.id }})
    function getExploitationInfos(id_exploitant){
        let contenu = '';
        let nb_forets  = 0;
        let nb_billes  = 0;
        let nb_arbres  = 0;
        let volume_billes  = 0;
        $('.div_table').addClass('text-center');
        document.querySelector('.div_table').innerHTML = '<img class=" mx-auto" src="{{ asset('assets/icons/spinner3.gif') }}" alt="spinner" height="300">'
        document.querySelector('.lbl_infos').innerHTML ='';
        if (id_exploitant){

            $.ajax({
                url : '{{ path('app_portail') }}snvlt/ref/exploitation/search/' + id_exploitant + '/data_json',
                type: 'POST',
                success : function (e){
                    let reponse = JSON.parse(e);

                    contenu  = '<table class="table" id="exploitants" style="border: 1px solid lightgrey;">' +
                        '<thead>' +
                        '<tr class="text-dark  alert-light">' +
                        '<th class="text-center">Foret</th>' +
                        '<th>Décision</th>' +
                        '<th>N° Autorisation</th>' +
                        '<th class="text-center">Quota</th>' +
                        '<th class="text-center">consommation</th>' +
                        '<th class="text-center">Arbres abattus</th>' +
                        '<th class="text-center">Billes transportées</th>' +
                        '<th class="text-center">Volume billes</th>' +
                        '<th class="text-center">Nb voyages</th>' +
                        '</tr>' +
                        '</thead>' +
                        '<tbody class="body_exploitation">';


                    for (var i = 0; i < reponse.length; i++){
                        if (reponse[i].volume_billes === 0){
                            contenu = contenu + '<tr class="text-danger font-weight-bold" style="font-size: 9px;">';
                        } else {
                            contenu = contenu + '<tr style="font-size: 9px;">';
                        }

                        contenu = contenu + '<td class="text-center" style="font-size: 12px;">' + reponse[i].foret + '</td>';
                        contenu = contenu + '<td style="font-size: 12px;">' + reponse[i].decision + '</td>';
                        contenu = contenu + '<td style="font-size: 12px;">' + reponse[i].autorisation + '</td>';
                        contenu = contenu + '<td class="text-center" style="font-size: 12px;">' + reponse[i].quota + '</td>';
                        contenu = contenu + '<td class="text-center font-weight-bold" style="font-size: 12px;">' + reponse[i].pourcentage + '%';

                        contenu = contenu + '</td>'
                        contenu = contenu + '<td class="text-center" style="font-size: 12px;">' + reponse[i].nb_arbres + '</td>';
                        contenu = contenu + '<td class="text-center" style="font-size: 12px;">' + reponse[i].nb_billes + '</td>';
                        contenu = contenu + '<td class="text-center" style="font-size: 12px;">' + reponse[i].volume_billes + '</td>';
                        contenu = contenu + '<td class="text-center" style="font-size: 12px;">' + reponse[i].nb_voyages + '</td>';
                        contenu = contenu + '</tr>';

                        nb_forets = nb_forets +1;
                        nb_arbres = nb_arbres + reponse[i].nb_arbres;
                        nb_billes = nb_billes + reponse[i].nb_billes;
                        volume_billes = volume_billes + reponse[i].volume_billes;
                    }
                    contenu = contenu + '</tbody></table>'

                    document.querySelector('.div_table').innerHTML = contenu;
                    document.querySelector('.lbl_infos').innerHTML = '<span style="margin-left: 5px">Forêts : ' + nb_forets.toLocaleString() + '</span><span style="margin-left: 25px">Arbres : ' + nb_arbres.toLocaleString() + '</span><span style="margin-left: 25px">Billes : ' + nb_billes.toLocaleString() + '</span><span style="margin-left: 25px;margin-right: 5px;">Volume Billes : ' + Math.round(volume_billes).toLocaleString() + 'm<sup>3</sup></span>';
                    window.print();
                    window.close();
                    document.reload()
                }
            })
        }
    }
</script>
</body>
</html>
